{% extends 'base.html' %}
{% load static %}
{% block content %}
  <h1>Department Information</h1>
    <table>

        <tr>
            <th>SN</th>
            <th>Department Name</th>
            <th>Edit</th>
            <th>Delete</th>
        </tr>
   
            {% for department in department %}
            <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ department.name }}</td>
            <td><button class="edit-button" data-id="{{ department.id }}">Edit</button></td>
            <td><button class="delete-button" data-id="{{ department.id }}">Delete</button></td>
        </tr>
            {% endfor %}
       

<!-- 
        {% for department in department %}
            <li>{{ department.name }}</li>
        {% endfor %} -->
    </table>
    <form id="departmentForm">
        {% csrf_token %}
        <fieldset>
            <legend >Add department here : </legend>
            <label for="name">Department Name:</label>
            <input type="text" id="name" name="name" required><br><br>
            <input type="submit" value="Add Department">
        </fieldset>    
    </form>


<style>
    table{
        width: 100%;
    }
    fieldset {
      background-color: #eeeeee;
    }
    
    legend {
      background-color: gray;
      color: white;
      padding: 5px 10px;
    }
    
    input {
      margin: 5px;
    }
</style>


<script>
    document.getElementById('departmentForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = new FormData(event.target);
        const jsonData = {
        "name": formData.get("name") // Get the value from the input field
    };

        const apiUrl = '/api/departments/'; // Correct API endpoint
        console.log(JSON.stringify(jsonData))
        fetch(apiUrl, {
            method: 'POST',
            headers: {
                "X-CSRFToken": '{{csrf_token}}' ,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(jsonData),
        })
        .then(response => response.json())
        .then(data => {
            location.reload();
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
     // Function to handle edit and delete button clicks
     document.addEventListener("click", function(event) {
        if (event.target.classList.contains("edit-button")) {
            const departmentId = event.target.getAttribute("data-id");
            console.log("Edit button clicked"); // Add this line for debugging
            // Handle edit button click (e.g., open a modal for editing)
            // You can make an AJAX request to retrieve department details for editing.
        } else if (event.target.classList.contains("delete-button")) {
            const departmentId = event.target.getAttribute("data-id");
            console.log("Delete button clicked"); // Add this line for debugging
            // Handle delete button click (e.g., show a confirmation dialog)
            // You can make an AJAX request to delete the department.
            if (confirm("Are you sure you want to delete this department?")) {
                const apiUrl = `/api/departments/${departmentId}/`; // Replace with the correct API endpoint
                fetch(apiUrl, {
                    method: 'DELETE',
                    headers: {
                        "X-CSRFToken": '{{ csrf_token }}', // Replace with the Django CSRF token
                    },
                })
                .then(response => response.json())
                .then(data => {
                    location.reload();
                })              
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        }
    });
</script>
{% endblock %}