




{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0">
          Department
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addModal">
            <i class="fas fa-plus"></i>
          </button>
        </h1>
      </div>
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item"><a href="#">Home</a></li>
          <li class="breadcrumb-item active">Dashboard v1</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<section class="content">
  <div class="container-fluid">
    <table class="table table-hover">
      {% csrf_token %}
      <thead>
        <tr>
          <th>SN</th>
          <th>Department Name</th>
          <th>Edit</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        {% for department in department %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ department.name }}</td>
          <td>
            <button type="button" class="btn btn-primary edit-btn" data-id="{{ department.id }}" data-value="{{ department.name }}">
              Edit
            </button>
          </td>
          <td>
            <button type="button" class="btn btn-primary delete-btn" data-id="{{ department.id }}">
              Delete
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalCenter" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addModalTitle">New department</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <input type="text" class="form-control" id="newDepartmentData" placeholder="Enter department name:" />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="createBtn">Create</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalCenter" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalTitle">Edit department</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {% csrf_token %}
        <input type="hidden" id="editDepartmentId" name="id" />
        <label for="updatedDepartmentName">Department Name:</label>
        <input type="text" id="updatedDepartmentName" name="name" required /><br /><br />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="updateBtn">Update</button>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    // Add Modal and reload
    $("#createBtn").click(function () {
      const departmentName = $("#newDepartmentData").val();

      console.log("Data:", departmentName);

      $.ajax({
        url: "/api/departments/",
        type: "POST",
        data: JSON.stringify({ name: departmentName }),
        contentType: "application/json",
        headers: { "X-CSRFToken": "{{ csrf_token }}" },
        success: function (response) {
          console.log("Department added successfully:", response);
          location.reload();
        },
        error: function (error) {
          console.error("Error adding department:", error);
        },
      });
    });

    // Handle delete button click and reload
    $(document).on("click", ".delete-btn", function () {
      const departmentId = $(this).data("id");
      console.log("Delete button clicked for department ID: " + departmentId);
      // Handle delete button click (e.g., show a confirmation dialog)
      // You can make an AJAX request to delete the department.
      if (confirm("Are you sure you want to delete this department?")) {
        $.ajax({
          url: `/api/departments/${departmentId}/`,
          type: "DELETE",
          headers: {
            "X-CSRFToken": "{{ csrf_token }}",
          },
          success: function (data) {
            location.reload();
          },
          error: function (error) {
            console.error("Error:", error);
          },
        });
      }
    });

    // Edit Modal and reload
    $(".edit-btn").click(function () {
      const departmentId = $(this).data("id");
      const departmentName = $(this).data("value");

      $("#editDepartmentId").val(departmentId);
      $("#updatedDepartmentName").val(departmentName);

      $("#updateBtn").data("departmentId", departmentId);

      $("#editModal").modal("show");
    });

    // Update button
    $("#updateBtn").click(function (event) {
      event.preventDefault();

      const departmentId = $(this).data("departmentId");
      const departmentName = $("#updatedDepartmentName").val();
      const updatedData = { id: departmentId, name: departmentName };

      $.ajax({
        url: `/api/departments/${departmentId}/`,
        type: "PUT",
        data: JSON.stringify(updatedData),
        contentType: "application/json",
        headers: { "X-CSRFToken": "{{ csrf_token }}" },
        success: function (response) {
          console.log("Department updated successfully. Response:", response);
          location.reload();
        },
        error: function (error) {
          console.error("Error updating department:", error);
        },
      });
    });
  });
</script>

{% endblock %}
