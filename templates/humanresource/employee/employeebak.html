{% extends 'base.html' %}
{% load static %}
{% block content %}
<h1>Employee Information</h1>
<table>
    {% csrf_token %}
    <tr>
        <th>SN</th>
        <th>Employee Name</th>
        <th>Edit</th>
        <th>Delete</th>
    </tr>
    {% for employee in employees %}
    <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ employee.name }}</td>
        <td><button class="edit-button" data-id="{{ employee.id }}">Edit</button></td>
        <td><button class="delete-button" data-id="{{ employee.id }}">Delete</button></td>
    </tr>
    {% endfor %}
</table>

<!-- Add Employee Button -->
<button class="add-button" data-id="addEmployee">Create new employee</button>

<!-- The Modal -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h2>Edit Employee</h2>
        <form id="editEmployeeForm">
            {% csrf_token %}
            <input type="hidden" id="editEmployeeId" name="id" value="">
            <label for="editName">Employee Name:</label>
            <input type="text" id="editName" name="name" required><br><br>
            <button type="submit" id="editSubmitButton">Save</button>
        </form>
    </div>
</div>

<style>
    table {
        border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        border: 1px solid #ddd;
    }

    th, td {
        text-align: left;
        padding: 16px;
    }

    tr:nth-child(even) {
        background-color: #f3f3f3;
    }

    fieldset {
        background-color: #eeeeee;
    }

    legend {
        background-color: gray;
        color: white;
        padding: 5px 10px;
    }

    input {
        margin: 5px;
    }

    /* Modal styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
        background-color: #fff;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 50%;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
    }

    .close {
        float: right;
        cursor: pointer;
        font-size: 24px;
    }
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // JavaScript/jQuery code to handle the Add/Edit Employee modal
    $(document).ready(function () {
        // Show the Add/Edit Employee modal when the modal is triggered
        $('#editModal').on('shown.bs.modal', function () {
            // Clear the employee ID input
            $('#editEmployeeId').val('');
            // Clear the employee name input
            $('#editName').val('');
        });

        // Handle form submission for both adding and editing employees
        $('#editEmployeeForm').submit(function (event) {
            event.preventDefault();
            // Prepare the employee data for addition/editing
            const employeeId = $('#editEmployeeId').val();
            const employeeName = $('#editName').val();
            const employeeData = {
                id: employeeId,
                name: employeeName,
            };

            // Determine whether to use POST (add) or PUT (edit) based on the presence of employeeId
            const requestType = employeeId ? 'PUT' : 'POST';
            const apiUrl = employeeId ? `/api/employees/${employeeId}/` : '/api/employees/';

            $.ajax({
                url: apiUrl,
                type: requestType,
                data: JSON.stringify(employeeData),
                contentType: 'application/json',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}', // Replace with your Django CSRF token
                },
                success: function (data) {
                    // Handle success (e.g., close modal and refresh employee list)
                    $('#editModal').modal('hide');
                    location.reload(); // Reload the page or update the employee list dynamically
                },
                error: function (error) {
                    // Handle errors (e.g., display error message)
                    console.log(error);
                }
            });
        });

        // Handle edit button click to open the modal and fetch employee data
        $(document).on("click", ".edit-button", function () {
            var employeeId = $(this).data("id");
            console.log("Edit button clicked for employee ID: " + employeeId);

            // Fetch employee data using AJAX (replace with your API endpoint)
            $.ajax({
                url: "/api/employees/" + employeeId + "/",
                type: "GET",
                success: function (data) {
                    // Populate the modal fields with employee data
                    $("#editEmployeeId").val(data.id);
                    $("#editName").val(data.name);

                    // Show the modal
                    $("#editModal").css("display", "block");
                },
                error: function (error) {
                    console.error("Error fetching employee data:", error);
                },
            });
        });

        // Handle modal close button click
        $("#closeModal").click(function () {
            $("#editModal").css("display", "none");
        });

        // Handle delete button click and reload
        $(document).on("click", ".delete-button", function () {
            const employeeId = $(this).data("id");
            console.log("Delete button clicked for employee ID: " + employeeId);
            // Handle delete button click (e.g., show a confirmation dialog)
            // You can make an AJAX request to delete the employee.
            if (confirm("Are you sure you want to delete this employee?")) {
                const apiUrl = `/api/employees/${employeeId}/`;
                $.ajax({
                    url: apiUrl,
                    type: 'DELETE',
                    headers: {
                        "X-CSRFToken": "{{ csrf_token }}",
                    },
                    success: function (data) {
                        location.reload();
                    },
                    error: function (error) {
                        console.error('Error:', error);
                    }
                });
            }
        });
    });

    // Handle add button click to open the modal and post employee data
    $(document).on("click", ".add-button", function () {
        console.log("Add button is clicked ");
        event.preventDefault();
        resetForm();
        $("#editModal").css("display", "block");
    });

    // Function to reset the form and set the modal title
    function resetForm() {
        $('#editEmployeeId').val('');
        $('#editName').val('');
        $('#editModal h2').text('Add Employee');
    }
</script>
{% endblock %}










<div class="container-fluid">
    <div class="row">
        
    <h1>Employee Information</h1>
    <table class="table table-hover">
        <thead >
            {% csrf_token %}
            <tr>
                <th>SN</th>
                <th>Employee Name</th>
                <th>Employee department</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for employee in employee %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ employee.name }}</td>
                    <td>{{ employee.department }}</td>
                    <td>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editEmployee" data-id="{{ employee.id }}" > Edit </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-primary delete-button" data-id="{{ employee.id }}"> Delete </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
        <div class="row">
                <!-- Add Employee Button -->
    <button type="button" class="btn btn-default btn-lg btn-block" data-toggle="modal" data-target="#addEmployee">
        Create new employee
    </button>
            
        </div>
    
    
</div>

    <div class="modal fade" id="addEmployee">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Add Employee Model</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="employeeform">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="card-body">
                            <div class="form-group">
                                <label for="Name">Name</label>
                                <input type="text" class="form-control " id="name" name="name"
                                       placeholder="Enter name">
                            </div>

                            <div class="form-group">
                                <label for="department">Department</label>
                                <div class="input-group">
                                    <select class="custom-select  form-control-border" name="department"
                                            id="department">
                                        {% for department in department %}
                                            <option value="{{ department.id }}">{{ department }}</option>    {% endfor %}
                                    </select>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" id="save-btn-employee" name="save-btn-employee" class="btn btn-primary">
                            Save
                            changes
                        </button>

                    </div>

                </form>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        

        $(document).ready(function () {

            // Event listener for the "Save changes" button in the modal
            $('#employeeform').submit(function (e) {

                e.preventDefault();
                var formData = $(this).serialize();

                {# var formData = $("#addEmployeeform").serialize();#}
                console.log(formData)
                console.log(apiUrl)
                $.ajax({
                    url: apiUrl,
                    method: 'POST',
                    data: formData,
                    success: function () {
                        location.reload();
                        alert('Your form has been sent successfully.');
                    },
                    error: function (xhr, status, error) {
                        console.error("Error:", error);
                    }
                });
            });
        });
    </script>

















{% extends 'base.html' %} {% load static %} {% block content %}

<!--                Content Header (Page header) -->
<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0">
          Employee
          <button
            type="button"
            class="btn btn-primary"
            data-toggle="modal"
            data-target="#addEmployee"
          >
            <i class="fas fa-plus"></i>
          </button>
        </h1>
      </div>
      <!-- /.col -->
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item"><a href="#">Home</a></li>
          <li class="breadcrumb-item active">Dashboard v1</li>
        </ol>
      </div>
      <!-- /.col -->
    </div>
    <!-- /.row -->
  </div>
  <!-- /.container-fluid -->
</div>
<!--                /.content-header -->

<!--                 Main content -->
<section class="content">
  <div class="container-fluid">
    <table class="table table-hover">
      {% csrf_token %}
      <thead>
        <tr>
          <th>SN</th>
          <th>Employee Name</th>
          <th>Edit</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        {% for employee in employee %}
        <tr>
          <td>{{ forloop.counter}}</td>
          <td>{{ employee.name }}</td>
          <td>
            <button
              type="button"
              class="btn btn-primary editBtn"
              data-id="{{employee.id}}"
              data-value="{{employee.name}"
            >
              Edit
            </button>
          </td>
          <td>
            <button
              type="button"
              class="btn btn-primary deleteBtn"
              data-id="{{employee.id}}"
            >
              Delete
            </button>
          </td>
        </tr>
        {%endfor%}
      </tbody>
    </table>
  </div>
</section>

<!--                /Main content -->

<!--                add employee modal -->

<div class="modal fade" id="addEmployee">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Add Employee Model</h4>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form id="employeeform">
        {% csrf_token %}
        <div class="modal-body">
          <div class="card-body">
            <div class="form-group">
              <label for="Name">Name</label>
              <input
                type="text"
                class="form-control"
                id="name"
                name="name"
                placeholder="Enter name"
              />
            </div>

            <div class="form-group">
              <label for="department">Department</label>
              <div class="input-group">
                <select
                  class="custom-select form-control-border"
                  name="department"
                  id="department"
                >
                  {% for department in department %}
                  <option value="{{ department.id }}">{{ department }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer justify-content-between">
          <button type="button" class="btn btn-default" data-dismiss="modal">
            Close
          </button>
          <button
            type="submit"
            id="save-btn-employee"
            name="save-btn-employee"
            class="btn btn-primary"
          >
            Save changes
          </button>
        </div>
      </form>
    </div>
    <!--                /.modal-content -->
  </div>
  <!--              /.modal-dialog -->
</div>
<!--                /add employee modal -->

<!--                edit employee modal -->

<div class="modal fade" id="updateEmployee">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Add Employee Model</h4>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form id="updateEmployeeform">
        {% csrf_token %}
        <div class="modal-body">
          <div class="card-body">
            <div class="form-group">
              <label for="Name">Name</label>
              <input
                type="text"
                class="form-control"
                id="updatedEmployeeData"
                name="name"
                placeholder="Enter name"
              />
            </div>

            <div class="form-group">
              <label for="department">Department</label>
              <div class="input-group">
                <select
                  class="custom-select form-control-border"
                  name="department"
                  id="department"
                >
                  {% for department in department %}
                  <option value="{{ department.id }}">{{ department }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer justify-content-between">
          <button type="button" class="btn btn-default" data-dismiss="modal">
            Close
          </button>
          <button
            type="submit"
            id="updateBtn"
            name="update-btn-employee"
            class="btn btn-primary"
          >
            Save changes
          </button>
        </div>
      </form>
    </div>
    <!--                /.modal-content -->
  </div>
  <!--              /.modal-dialog -->
</div>
<!--                /edit employee modal

<!--                scpipt -->

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  const apiUrl = "/api/employees/";

  $(document).ready(function () {

      // Event listener for the "Save changes" button in the modal
      $('#employeeform').submit(function (e) {

          e.preventDefault();
          var formData = $(this).serialize();

          {# var formData = $("#addEmployeeform").serialize();#}
          console.log(formData)
          console.log(apiUrl)
          $.ajax({
              url: apiUrl,
              method: 'POST',
              data: formData,
              success: function () {
                  location.reload();
                  alert('Your form has been sent successfully.');
              },
              error: function (xhr, status, error) {
                  console.error("Error:", error);
              }
          });
      });

    // Handle delete button click and reload
    $(document).on("click", ".deleteBtn", function () {
      const employeeid = $(this).data("id");
      console.log("Delete button clicked for department ID: " + employeeid);
      // Handle delete button click (e.g., show a confirmation dialog)
      // You can make an AJAX request to delete the department.
      if (confirm("Are you sure you want to delete this department?")) {
        $.ajax({
          url: `/api/employees/${employeeid}/`,
          type: "DELETE",
          headers: {
            "X-CSRFToken": "{{ csrf_token }}",
          },
          success: function (data) {
            location.reload();
          },
          error: function (error) {
            console.error("Error:", error);
          },
        });
      }
    });

    // Edit Modal and reload
    // Edit button
    $(".editBtn").click(function () {
      const employeeid = $(this).data("id");
      const employeeName = $(this).data("value");
      console.log("edit button clicked")
      $("#editemployeeid").val(employeeid);
      $("#updatedemployeeName").val(employeeName);

      // Store employeeid in a data attribute of the update button
      $("#updateBtn").data("employeeid", employeeid);
      $("#updateBtn").data("employeeid", employeeid);
      $("#updateEmployee").modal("show");
    });

   //update button
   $("#updateBtn").click(function () {
  // Retrieve departmentId from the data attribute
  const employeeId = $(this).data("employeeId");
  const employeeName = $("#updatedEmployeeName").val();
  const updatedData = { id: employeeId, name: employeeName };
  console.log("Data:", updatedData);

  // Send a PUT request to update the department
  $.ajax({
    url: `/api/employees/${employeeId}/`,  // Use backticks for string interpolation    
    type: "PUT",
    data: updatedData,  // Use the correct variable
    contentType: "application/json",
    headers: {
      "X-CSRFToken": "{{ csrf_token }}",
    },
    success: function (response) {
      console.log("employee updated successfully. Response:", response);
      location.reload();
    },
    error: function (error) {
      console.error("Error updating employee:", error);
    },
  });
});









  });
</script>
<!--                /scpipt -->

{% endblock %}



















{% extends 'base.html' %} {% load static %} {% block content %}

<!-- Content Header (Page header) -->
<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0">
          Employee
          <button
            type="button"
            class="btn btn-primary"
            data-toggle="modal"
            data-target="#addEmployee"
          >
            <i class="fas fa-plus"></i>
          </button>
        </h1>
      </div>
      <!-- /.col -->
      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item"><a href="#">Home</a></li>
          <li class="breadcrumb-item active">Dashboard v1</li>
        </ol>
      </div>
      <!-- /.col -->
    </div>
    <!-- /.row -->
  </div>
  <!-- /.container-fluid -->
</div>
<!-- Main content -->
<section class="content">
  <div class="container-fluid">
    <table class="table table-hover">
      {% csrf_token %}
      <thead>
        <tr>
          <th>SN</th>
          <th>Employee Name</th>
          <th>Edit</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        {% for employee in employee %}
        <tr>
          <td>{{ forloop.counter}}</td>
          <td>{{ employee.name }}</td>
          <td>
            <button
              type="button"
              class="btn btn-primary editBtn"
              data-id="{{employee.id}}"
              data-value="{{employee.name}}"
            >
              Edit
            </button>
          </td>
          <td>
            <button
              type="button"
              class="btn btn-primary deleteBtn"
              data-id="{{employee.id}}"
            >
              Delete
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>


<!-- Add employee modal -->
<div class="modal fade" id="addEmployee">
  <!-- Modal content -->
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Add Employee</h4>
        <button type="button" class="close" data-dismiss="modal">
          &times;
        </button>
      </div>
      <form id="employeeForm">
        {% csrf_token %}
        <div class="modal-body">
          <div class="card-body">
            <div class="form-group">
              <label for="name">Name</label>
              <input
                type="text"
                class="form-control"
                id="employeeName"
                name="name"
                placeholder="Enter name"
              />
            </div>
            <div class="form-group">
              <label for="department">Department</label>
              <select
                class="custom-select form-control"
                name="department"
                id="employeeDepartment"
              >
                {% for department in department %}
                <option value="{{ department.id }}">
                  {{ department.name }}
                </option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">
            Close
          </button>
          <button type="submit" class="btn btn-primary" id="saveEmployeeBtn">
            Save
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit employee modal -->
<div class="modal fade" id="editEmployee">
  <!-- Modal content -->
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Edit Employee</h4>
        <button type="button" class="close" data-dismiss="modal">
          &times;
        </button>
      </div>
      <form id="editEmployeeForm">
        {% csrf_token %}
        <div class="modal-body">
          <div class="card-body">
            <div class="form-group">
              <label for="name">Name</label>
              <input
                type="text"
                class="form-control"
                id="updatedEmployeeName"
                name="name"
                placeholder="Enter name"
              />
            </div>
            <div class="form-group">
              <label for="department">Department</label>
              <select
                class="custom-select form-control"
                name="department"
                id="updatedEmployeeDepartment"
              >
                {% for department in department %}
                <option value="{{ department.id }}">
                  {{ department.name }}
                </option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">
            Close
          </button>
          <button type="submit" class="btn btn-primary" id="updateEmployeeBtn">
            Update
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Script -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  const apiUrl = "/api/employees/";

  $(document).ready(function () {
    // Event listener for the "Save" button in the add employee modal
    $("#employeeForm").submit(function (e) {
      e.preventDefault();
      const formData = $(this).serialize();
      console.log(formData);

      // Send a POST request to create a new employee
      $.ajax({
        url: apiUrl,
        method: "POST",
        data: formData,
        success: function () {
          location.reload();
          alert("Employee added successfully.");
        },
        error: function (xhr, status, error) {
          console.error("Error:", error);
        },
      });
    });

    // Handle delete button click and reload
    $(document).on("click", ".deleteBtn", function () {
      const employeeId = $(this).data("id");
      console.log("Delete button clicked for employee ID: " + employeeId);
      if (confirm("Are you sure you want to delete this employee?")) {
        $.ajax({
          url: `/api/employees/${employeeId}/`,
          type: "DELETE",
          headers: {
            "X-CSRFToken": "{{ csrf_token }}",
          },
          success: function (data) {
            location.reload();
          },
          error: function (error) {
            console.error("Error:", error);
          },
        });
      }
    });



// Edit button click event for employees
$(".editBtn").click(function () {
  const employeeId = $(this).data("id");
  const employeeName = $(this).data("value");

  $("#updatedEmployeeId").val(employeeId);
  $("#updatedEmployeeName").val(employeeName);

  // Store employeeId in a data attribute of the update button
  $("#updateEmployeeBtn").data("employeeId", employeeId);

  $("#editEmployee").modal("show");
});

// Update button click event for employees
$("#updateEmployeeBtn").click(function (event) {
  event.preventDefault();

  // Retrieve employeeId from the data attribute
  const employeeId = $(this).data("employeeId");
  const employeeName = $("#updatedEmployeeName").val();
  const employeeDepartment = $("#updatedEmployeeDepartment").val();
  const updatedData = {
    id: employeeId,
    name: employeeName,
    department: employeeDepartment,
  };

  // Send a PUT request to update the employee
  $.ajax({
    url: `/api/employees/${employeeId}/`,  // Adjust the API endpoint as needed    
    type: "PUT",  // Change to 'PATCH' if required by your API
    data: JSON.stringify(updatedData),
    contentType: "application/json",
    headers: {
      "X-CSRFToken": "{{ csrf_token }}",
    },
    success: function (response) {
      console.log("Employee updated successfully. Response:", response);
      location.reload();  // Refresh the page or update the table as needed
    },
    error: function (error) {
      console.error("Error updating employee:", error);
    },
  });
});




  
  });
</script>
<!-- /Script -->

{% endblock %}
